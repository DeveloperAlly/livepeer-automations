{
  "name": "Discourse Latest → Top 4 → Original Post Only → MDX",
  "nodes": [
    {
      "id": 1,
      "name": "Cron Latest",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [200, 300],
      "parameters": {
        "triggerTimes": [
          { "hour": 9, "minute": 0 }
        ]
      }
    },
    {
      "id": 2,
      "name": "Fetch Latest Topics",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [500, 300],
      "parameters": {
        "method": "GET",
        "url": "https://forum.livepeer.org/latest.json",
        "responseFormat": "json"
      }
    },
    {
      "id": 3,
      "name": "Extract Top 4 Topic IDs",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [800, 300],
      "parameters": {
        "functionCode": "const topics = items[0].json.topic_list?.topics || [];\nconst top4 = topics.slice(0, 4);\nreturn top4.map(t => ({ json: { id: t.id, title: t.title } }));"
      }
    },
    {
      "id": 4,
      "name": "Fetch Topic JSON",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1100, 300],
      "parameters": {
        "method": "GET",
        "url": "=https://forum.livepeer.org/t/{{$json.id}}.json",
        "responseFormat": "json"
      }
    },
    {
      "id": 5,
      "name": "Extract Original Post Only",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1400, 300],
      "parameters": {
        "functionCode": "const topic = items[0].json;\nconst first = topic.post_stream?.posts?.find(p => p.post_number === 1);\nreturn [{ json: {\n  id: topic.id,\n  title: topic.title,\n  url: `https://forum.livepeer.org/t/${topic.id}`,\n  body: first?.cooked || \"\"\n}}];"
      }
    },
    {
      "id": 6,
      "name": "Aggregate Topics",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1700, 300],
      "parameters": {
        "functionCode": "return [{ json: { topics: items.map(i => i.json) } }];"
      }
    },
    {
      "id": 7,
      "name": "Build MDX Latest",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [2000, 300],
      "parameters": {
        "functionCode": "const topics = items[0].json.topics;\nlet mdx = `## Latest Forum Topics\\\\n\\\\n`;\nfor (const t of topics) {\n  mdx += `### [${t.title}](${t.url})\\\\n\\\\n`;\n  mdx += t.body + \"\\\\n\\\\n---\\\\n\\\\n\";\n}\nreturn [{ json: { fileContent: mdx } }];"
      }
    },
    {
      "id": 8,
      "name": "Commit Latest MDX",
      "type": "n8n-nodes-base.github",
      "typeVersion": 2,
      "position": [2300, 300],
      "credentials": {
        "githubApi": { "name": "GitHub Repo Token" }
      },
      "parameters": {
        "resource": "file",
        "operation": "createOrUpdate",
        "owner": "developerally",
        "repository": "livepeer-docs",
        "filePath": "docs/forum/latest.mdx",
        "fileContent": "={{$json.fileContent}}",
        "commitMessage": "Update latest topics (top 4, original post only)"
      }
    }
  ],
  "connections": {
    "Cron Latest": { "main": [[{ "node": "Fetch Latest Topics", "type": "main", "index": 0 }]] },
    "Fetch Latest Topics": { "main": [[{ "node": "Extract Top 4 Topic IDs", "type": "main", "index": 0 }]] },
    "Extract Top 4 Topic IDs": { "main": [[{ "node": "Fetch Topic JSON", "type": "main", "index": 0 }]] },
    "Fetch Topic JSON": { "main": [[{ "node": "Extract Original Post Only", "type": "main", "index": 0 }]] },
    "Extract Original Post Only": { "main": [[{ "node": "Aggregate Topics", "type": "main", "index": 0 }]] },
    "Aggregate Topics": { "main": [[{ "node": "Build MDX Latest", "type": "main", "index": 0 }]] },
    "Build MDX Latest": { "main": [[{ "node": "Commit Latest MDX", "type": "main", "index": 0 }]] }
  }
}
